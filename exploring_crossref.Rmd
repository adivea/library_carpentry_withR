---
title: "first look at the dataset"
output:
  pdf_document: default
  html_notebook: default
  word_document: default
---

- library data
- automation

## Load Library Package

"Use the [Tidyverse](https://www.tidyverse.org/), Luke" -- O-W.Kenobi 

```{r}
library(tidyverse)
library(skimr)
```

## Get Data

Crossref data used from the **Setup** to the [LC OpenRefine Workshop](https://librarycarpentry.org/lc-open-refine/setup.html)

```{r}
crossref_data <- read_csv("https://raw.githubusercontent.com/LibraryCarpentry/lc-open-refine/gh-pages/data/doaj-article-sample.csv", 
    col_types = cols(Date = col_date(format = "%m/%d/%Y")))
```


```{r}
crossref_data
```

## skimr

```{r}
skim(crossref_data)
```


## Facetting

Generate a quick table of the languages represented in the dataframe.  Looks like English (spelled two different ways), FRench and ?Spanish? (represented by ES).

```{r}
crossref_data %>% 
  count(Language)
```

This time, facet on the governing license

```{r}
crossref_data %>% 
  count(Licence)
```

Facet on the publisher

```{r}
crossref_data %>% 
  count(Publisher)
```

Facet by authors, and sort by the most prolific.  This field appears to be a multi-valued field that is pipe `|` separated.  How do we count and visualize how many articles have multiple authors?

```{r}
crossref_data %>% 
  count(Authors) %>% 
  arrange(-n)
```

Exploring some methods to generate a cound of the pipe delimeter.  `stringr::str_count()` appears to be a great way to calculate this.

```{r}
dim(as_tibble(str_split(crossref_data$Authors[5], "\\|", simplify = TRUE)))[2]

str_count(crossref_data$Authors[1:5], "\\|")
```

## Transform Data

Use `dplyr::mutate` to generate a new field that calculates how many authors each observation contains.

```{r}
crossref_data %>% 
  select(Authors) %>% 
  mutate(multi_authorship = str_count(Authors, "\\|") + 1) %>% 
  select(Authors, multi_authorship)
```

## Visualize

### Authors

Generate a histogram distribution of the multiple authorship variable.

```{r}
crossref_data %>% 
  select(Authors) %>% 
  mutate(multi_authorship = str_count(Authors, "\\|") + 1) %>% 
  select(multi_authorship, Authors) %>% 
  ggplot() +
  aes(multi_authorship) +
  geom_histogram()
```

This time generate as a bargraph and sort by the most frequent representation.  Articles with five authors is the most frequent representation in the dataset. 

```{r}
auth_count <- crossref_data %>% 
  select(Authors) %>% 
  mutate(multi_authorship = str_count(Authors, "\\|") + 1) %>% 
  mutate(multi_authorship = as.character(multi_authorship)) %>% 
  select(multi_authorship, Authors)

ggplot(auth_count) +
  aes(fct_rev(fct_infreq(multi_authorship))) +
  geom_bar() +
  coord_flip()
```

### Explore Subject Headings

Visualize the frequency of multiple subject headings, just as with authors (A bargraph and a histogram)

```{r}
crossref_data %>% 
  mutate(SH_count = str_count(Subjects, "\\|") + 1) %>% 
  mutate(SH_count = as.character(SH_count)) %>% 
  ggplot() +
  aes(fct_rev(fct_infreq(SH_count))) +
  geom_bar() +
  coord_flip()

crossref_data %>% 
  mutate(SH_count = str_count(Subjects, "\\|") + 1) %>% 
  ggplot() +
  aes(SH_count) +
  geom_histogram() 
```


## Data Transformations

Using dplyr, mutate a new variable and transform the data so that 'EN' and 'English' are the same.  Transform 'ES' to "Spanish", and 'FR' to "French".  

`dplyr::case_when()` is one specialized way to perform an `if_else` transformation.

```{r}
crossref_data %>% 
  count(Language)
```


```{r}
crossref_data <- crossref_data %>% 
  mutate(Language = case_when(
    Language == "EN" ~ "English",
    Language == "ES" ~ "Spanish",
    Language == "FR" ~ "French"
  )) 
```

### Visualize the Languages. 

Stacked Bargraph shows frequency by Language. Each stack of a bar distinguishes the publishers. English Language is huge and somewhat over-powers the reset of the graph.  Make a second graph (below) to drill down on the lesser represented languages.

```{r}
crossref_data %>% 
  ggplot() +
  aes(fct_rev(fct_infreq(Language)), fill = Publisher) +
  geom_bar() +
  coord_flip() +
  theme(legend.position="top") 
```

Filter the data to show only the "NA", "French", and "Spanish".

```{r}
crossref_data %>% 
  filter(is.na(Language) | Language == "French" | Language == "Spanish") %>% 
  ggplot() +
  aes(fct_rev(fct_infreq(Language)), fill = Publisher) +
  geom_bar() +
  coord_flip() +
  theme(legend.position="top") 
```

## Time Series

```{r}
crossref_data %>% 
  count(Date) %>% 
  ggplot(aes(Date, n)) +
  geom_point() +
  geom_line() +
  ggtitle("Publishing Date Frequency", subtitle = "One Week in January, 2015")
  
```

